<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2v2 Soccer Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        .game-container {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        canvas {
            border: 4px solid #2E7D32;
            border-radius: 10px;
            background: #4CAF50;
            display: block;
        }
        
        .controls {
            margin-top: 15px;
            text-align: center;
            color: #2E7D32;
        }
        
        .score {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            color: #2E7D32;
        }
        
        .instructions {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
            text-align: center;
            max-width: 600px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="score">
            <span>Blue Team: <span id="playerScore">0</span></span>
            <span style="margin: 0 30px;">|</span>
            <span>Red Team: <span id="aiScore">0</span></span>
        </div>
        
        <canvas id="gameCanvas" width="800" height="500"></canvas>
        
        <div class="controls">
            <strong>Controls:</strong> A/D = Backward/Forward | W/S = Left/Right | SPACE = Shoot | E = Pass
        </div>
        
        <div class="instructions">
            Touch the ball to start dribbling. While dribbling: SPACE to shoot at goal, E to pass to teammate. 
            Blue team scores on the right goal, Red team scores on the left goal. First to 5 goals wins!
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game state
        let gameState = {
            playerScore: 0,
            aiScore: 0,
            gameRunning: true
        };
        
        // Player (human controlled)
        const player = {
            x: 100,
            y: 200,
            radius: 18,
            speed: 4,
            color: '#1976D2',
            hasBall: false,
            team: 'blue'
        };
        
        // Player's AI teammate
        const teammate = {
            x: 150,
            y: 300,
            radius: 18,
            speed: 2.8,
            color: '#42A5F5',
            hasBall: false,
            team: 'blue',
            targetX: 150,
            targetY: 300,
            role: 'support'
        };
        
        // AI opponents (red team)
        const enemy1 = {
            x: 650,
            y: 150,
            radius: 18,
            speed: 2.5,
            color: '#D32F2F',
            hasBall: false,
            team: 'red',
            targetX: 650,
            targetY: 150,
            role: 'attacker'
        };
        
        const enemy2 = {
            x: 700,
            y: 350,
            radius: 18,
            speed: 2.3,
            color: '#F44336',
            hasBall: false,
            team: 'red',
            targetX: 700,
            targetY: 350,
            role: 'defender'
        };
        
        // Ball object
        const ball = {
            x: 400,
            y: 250,
            radius: 12,
            vx: 0,
            vy: 0,
            color: '#FFFFFF',
            friction: 0.98,
            owner: null
        };
        
        // Goals - Blue scores on right, Red scores on left
        const goals = {
            blue: { x: 780, y: 200, width: 20, height: 100 }, // Blue team's target (right side)
            red: { x: 0, y: 200, width: 20, height: 100 }      // Red team's target (left side)
        };
        
        // All players array for easier management
        const allPlayers = [player, teammate, enemy1, enemy2];
        
        // Input handling
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });
        
        // Distance calculation
        function distance(obj1, obj2) {
            return Math.sqrt((obj1.x - obj2.x) ** 2 + (obj1.y - obj2.y) ** 2);
        }
        
        // Check if position overlaps with other players
        function checkPlayerCollision(movingPlayer, newX, newY) {
            for (let other of allPlayers) {
                if (other === movingPlayer) continue;
                
                const dist = Math.sqrt((newX - other.x) ** 2 + (newY - other.y) ** 2);
                if (dist < movingPlayer.radius + other.radius) {
                    return true;
                }
            }
            return false;
        }
        
        // Find best open position for teammate
        function findOpenPosition(p) {
            const ballCarrier = ball.owner;
            if (!ballCarrier || ballCarrier.team !== p.team) {
                return { x: p.x, y: p.y };
            }
            
            // Try to get open ahead of ball carrier
            const baseX = ballCarrier.x + (ballCarrier.team === 'blue' ? 100 : -100);
            const baseY = ballCarrier.y;
            
            // Check multiple positions around the base position
            const positions = [
                { x: baseX, y: baseY },
                { x: baseX, y: baseY - 80 },
                { x: baseX, y: baseY + 80 },
                { x: baseX + 50, y: baseY - 40 },
                { x: baseX + 50, y: baseY + 40 },
                { x: baseX - 50, y: baseY - 40 },
                { x: baseX - 50, y: baseY + 40 }
            ];
            
            for (let pos of positions) {
                // Keep in bounds
                pos.x = Math.max(p.radius, Math.min(canvas.width - p.radius, pos.x));
                pos.y = Math.max(p.radius, Math.min(canvas.height - p.radius, pos.y));
                
                // Check if position is clear
                let clear = true;
                for (let other of allPlayers) {
                    if (other === p) continue;
                    const dist = Math.sqrt((pos.x - other.x) ** 2 + (pos.y - other.y) ** 2);
                    if (dist < p.radius + other.radius + 10) {
                        clear = false;
                        break;
                    }
                }
                
                if (clear) {
                    return pos;
                }
            }
            
            return { x: p.x, y: p.y }; // Stay in current position if no good spot found
        }
        
        // Find closest teammate
        function findClosestTeammate(currentPlayer) {
            let closest = null;
            let minDist = Infinity;
            
            allPlayers.forEach(p => {
                if (p !== currentPlayer && p.team === currentPlayer.team) {
                    const dist = distance(currentPlayer, p);
                    if (dist < minDist) {
                        minDist = dist;
                        closest = p;
                    }
                }
            });
            
            return closest;
        }
        
        // Ball possession check
        function checkBallPossession() {
            let closestPlayer = null;
            let minDist = Infinity;
            
            allPlayers.forEach(p => {
                const dist = distance(p, ball);
                if (dist < p.radius + ball.radius + 5 && dist < minDist) {
                    minDist = dist;
                    closestPlayer = p;
                }
            });
            
            // Update possession
            allPlayers.forEach(p => p.hasBall = false);
            
            if (closestPlayer) {
                ball.owner = closestPlayer;
                closestPlayer.hasBall = true;
            } else {
                ball.owner = null;
            }
        }
        
        // Player movement and actions
        function updatePlayer() {
            let dx = 0, dy = 0;
            
            if (keys['a']) dx = -player.speed; // Backward
            if (keys['d']) dx = player.speed;  // Forward
            if (keys['w']) dy = -player.speed; // Left (up)
            if (keys['s']) dy = player.speed;  // Right (down)
            
            // Calculate new position
            let newX = player.x + dx;
            let newY = player.y + dy;
            
            // Keep player in bounds
            newX = Math.max(player.radius, Math.min(canvas.width - player.radius, newX));
            newY = Math.max(player.radius, Math.min(canvas.height - player.radius, newY));
            
            // Check for collisions with other players
            if (!checkPlayerCollision(player, newX, newY)) {
                player.x = newX;
                player.y = newY;
            }
            
            // Ball follows player when dribbling
            if (player.hasBall) {
                ball.x = player.x + (dx !== 0 ? Math.sign(dx) * 25 : 25);
                ball.y = player.y;
                ball.vx = 0;
                ball.vy = 0;
                
                // Shooting (SPACE key)
                if (keys[' ']) {
                    const shootPower = 12;
                    ball.vx = shootPower;
                    ball.vy = (goals.blue.y + goals.blue.height/2 - ball.y) * 0.1 + (Math.random() - 0.5) * 3;
                    player.hasBall = false;
                    ball.owner = null;
                }
                
                // Passing (E key)
                if (keys['e']) {
                    const teammatePos = findClosestTeammate(player);
                    if (teammatePos) {
                        const passPower = 8;
                        const dx = teammatePos.x - player.x;
                        const dy = teammatePos.y - player.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        ball.vx = (dx / dist) * passPower;
                        ball.vy = (dy / dist) * passPower;
                        player.hasBall = false;
                        ball.owner = null;
                    }
                }
            }
        }
        
        // AI teammate behavior - focuses on getting open
        function updateTeammate() {
            if (teammate.hasBall) {
                // Move toward goal
                teammate.targetX = Math.min(canvas.width - 100, teammate.x + 2);
                teammate.targetY = goals.blue.y + goals.blue.height/2;
                
                // Shoot if close to goal
                if (teammate.x > 600 && Math.random() < 0.03) {
                    ball.vx = 10;
                    ball.vy = (goals.blue.y + goals.blue.height/2 - ball.y) * 0.1;
                    teammate.hasBall = false;
                    ball.owner = null;
                }
                // Pass back to player if they're in better position
                else if (player.x > teammate.x && distance(teammate, player) < 150 && Math.random() < 0.02) {
                    const dx = player.x - teammate.x;
                    const dy = player.y - teammate.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    ball.vx = (dx / dist) * 7;
                    ball.vy = (dy / dist) * 7;
                    teammate.hasBall = false;
                    ball.owner = null;
                }
            } else if (ball.owner === player) {
                // Get open for a pass
                const openPos = findOpenPosition(teammate);
                teammate.targetX = openPos.x;
                teammate.targetY = openPos.y;
            } else if (ball.owner && ball.owner.team === 'red') {
                // Defend
                teammate.targetX = Math.max(100, ball.x - 50);
                teammate.targetY = ball.y;
            } else {
                // Chase ball
                teammate.targetX = ball.x - 30;
                teammate.targetY = ball.y;
            }
            
            // Move toward target
            const dx = teammate.targetX - teammate.x;
            const dy = teammate.targetY - teammate.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            
            if (dist > 5) {
                const moveX = teammate.x + (dx / dist) * teammate.speed;
                const moveY = teammate.y + (dy / dist) * teammate.speed;
                
                // Check bounds
                const boundedX = Math.max(teammate.radius, Math.min(canvas.width - teammate.radius, moveX));
                const boundedY = Math.max(teammate.radius, Math.min(canvas.height - teammate.radius, moveY));
                
                // Check collisions
                if (!checkPlayerCollision(teammate, boundedX, boundedY)) {
                    teammate.x = boundedX;
                    teammate.y = boundedY;
                }
            }
            
            // Ball follows when dribbling
            if (teammate.hasBall) {
                ball.x = teammate.x + 25;
                ball.y = teammate.y;
                ball.vx = 0;
                ball.vy = 0;
            }
        }
        
        // AI enemies behavior
        function updateEnemies() {
            [enemy1, enemy2].forEach(enemy => {
                if (enemy.hasBall) {
                    // Attack - move toward red goal (left side)
                    enemy.targetX = Math.max(50, enemy.x - 3);
                    enemy.targetY = goals.red.y + goals.red.height/2 + Math.sin(Date.now() * 0.003) * 30;
                    
                    // Shoot when close to goal
                    if (enemy.x < 200 && Math.random() < 0.025) {
                        ball.vx = -10;
                        ball.vy = (goals.red.y + goals.red.height/2 - ball.y) * 0.1 + (Math.random() - 0.5) * 4;
                        enemy.hasBall = false;
                        ball.owner = null;
                    }
                    // Pass to teammate
                    else if (Math.random() < 0.015) {
                        const teammate = enemy === enemy1 ? enemy2 : enemy1;
                        if (distance(enemy, teammate) < 150) {
                            const dx = teammate.x - enemy.x;
                            const dy = teammate.y - enemy.y;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            ball.vx = (dx / dist) * 7;
                            ball.vy = (dy / dist) * 7;
                            enemy.hasBall = false;
                            ball.owner = null;
                        }
                    }
                } else if (ball.owner && ball.owner.team === 'blue') {
                    // Defend against blue team
                    if (enemy.role === 'defender') {
                        enemy.targetX = Math.min(canvas.width - 100, ball.x + 80);
                        enemy.targetY = ball.y;
                    } else {
                        enemy.targetX = ball.x + 50;
                        enemy.targetY = ball.y;
                    }
                } else {
                    // Chase ball
                    enemy.targetX = ball.x + (enemy === enemy1 ? -30 : 30);
                    enemy.targetY = ball.y;
                }
                
                // Move toward target
                const dx = enemy.targetX - enemy.x;
                const dy = enemy.targetY - enemy.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist > 5) {
                    const moveX = enemy.x + (dx / dist) * enemy.speed;
                    const moveY = enemy.y + (dy / dist) * enemy.speed;
                    
                    // Check bounds
                    const boundedX = Math.max(enemy.radius, Math.min(canvas.width - enemy.radius, moveX));
                    const boundedY = Math.max(enemy.radius, Math.min(canvas.height - enemy.radius, boundedY));
                    
                    // Check collisions
                    if (!checkPlayerCollision(enemy, boundedX, boundedY)) {
                        enemy.x = boundedX;
                        enemy.y = boundedY;
                    }
                }
                
                // Ball follows when dribbling
                if (enemy.hasBall) {
                    ball.x = enemy.x + (enemy.x < canvas.width/2 ? -25 : 25);
                    ball.y = enemy.y;
                    ball.vx = 0;
                    ball.vy = 0;
                }
            });
        }
        
        // Ball physics
        function updateBall() {
            if (ball.owner) return;
            
            ball.x += ball.vx;
            ball.y += ball.vy;
            
            // Apply friction
            ball.vx *= ball.friction;
            ball.vy *= ball.friction;
            
            // Bounce off walls
            if (ball.x <= ball.radius || ball.x >= canvas.width - ball.radius) {
                ball.vx *= -0.8;
                ball.x = Math.max(ball.radius, Math.min(canvas.width - ball.radius, ball.x));
            }
            if (ball.y <= ball.radius || ball.y >= canvas.height - ball.radius) {
                ball.vy *= -0.8;
                ball.y = Math.max(ball.radius, Math.min(canvas.height - ball.radius, ball.y));
            }
        }
        
        // Goal detection - Blue scores on right, Red scores on left
        function checkGoals() {
            // Blue team scores (ball in right goal)
            if (ball.x >= goals.blue.x && ball.y >= goals.blue.y && ball.y <= goals.blue.y + goals.blue.height) {
                gameState.playerScore++;
                document.getElementById('playerScore').textContent = gameState.playerScore;
                resetBall();
            }
            
            // Red team scores (ball in left goal)
            if (ball.x <= goals.red.width && ball.y >= goals.red.y && ball.y <= goals.red.y + goals.red.height) {
                gameState.aiScore++;
                document.getElementById('aiScore').textContent = gameState.aiScore;
                resetBall();
            }
        }
        
        // Reset ball to center
        function resetBall() {
            ball.x = 400;
            ball.y = 250;
            ball.vx = 0;
            ball.vy = 0;
            ball.owner = null;
            allPlayers.forEach(p => p.hasBall = false);
            
            // Reset positions
            player.x = 100;
            player.y = 200;
            teammate.x = 150;
            teammate.y = 300;
            enemy1.x = 650;
            enemy1.y = 150;
            enemy2.x = 700;
            enemy2.y = 350;
        }
        
        // Render game
        function render() {
            // Clear canvas
            ctx.fillStyle = '#4CAF50';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw field markings
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 3;
            
            // Center line
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            
            // Center circle
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 60, 0, Math.PI * 2);
            ctx.stroke();
            
            // Goals
            ctx.fillStyle = '#333';
            ctx.fillRect(goals.red.x, goals.red.y, goals.red.width, goals.red.height);
            ctx.fillRect(goals.blue.x, goals.blue.y, goals.blue.width, goals.blue.height);
            
            // Goal areas
            ctx.strokeStyle = '#FFFFFF';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, 150, 80, 200);
            ctx.strokeRect(canvas.width - 80, 150, 80, 200);
            
            // Draw ball shadow
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.beginPath();
            ctx.arc(ball.x + 2, ball.y + 2, ball.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw ball
            ctx.fillStyle = ball.color;
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw all players
            allPlayers.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw possession indicator
                if (p.hasBall) {
                    ctx.strokeStyle = '#FFD700';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius + 5, 0, Math.PI * 2);
                    ctx.stroke();
                }
            });
        }
        
        // Game loop
        function gameLoop() {
            if (!gameState.gameRunning) return;
            
            updatePlayer();
            updateTeammate();
            updateEnemies();
            updateBall();
            checkBallPossession();
            checkGoals();
            render();
            
            requestAnimationFrame(gameLoop);
        }
        
        // Start game
        gameLoop();
    </script>
</body>
</html>
